import{d as Ft,t as l,b as i,c as D}from"../chunks/nBeogWpe.js";import{i as qt}from"../chunks/B4fBBnHg.js";import{Y as Bt,Z as It,_ as r,$ as a,a0 as t,a1 as w,g as e,a2 as G,m as tt,a3 as ct,c as xt}from"../chunks/DlLfKX1o.js";import{s as o}from"../chunks/DBKkpHwF.js";import{a as Gt,t as _t}from"../chunks/Be3Rg8Bg.js";import{s as Ht,a as Jt,i as g}from"../chunks/_IW-XRo_.js";import{e as pt,i as ut}from"../chunks/DGtoNUrL.js";import{u as Lt}from"../chunks/BQGHVGXH.js";async function Ot(m){try{if(!m)return null;const H=window.location.port!=="8000"?"http://localhost:8000":"",$=await fetch(`${H}/api/dashboard-data/`,{method:"GET",headers:{Authorization:`Token ${m.token}`,"Content-Type":"application/json"}});if(!$.ok){const u=(await $.json()).error||"Failed to fetch dashboard data";return console.log(u),null}return await $.json()}catch(c){return console.error("Error during login:",c),null}}var Rt=(m,c)=>xt(c,!e(c)),Vt=l('<button class="inline-button"> </button>'),Yt=l('<div class="flex justify-between items-center even:bg-[--muted-surface] px-4 py-1"><span class="capitalize"> </span> <div class="text-right"><div class="font-semibold"> </div> <div class="text-sm text-gray-500"> </div></div></div>'),Zt=(m,c)=>xt(c,!e(c)),Kt=l('<button class="inline-button"> </button>'),Mt=l('<div class="flex justify-between items-center even:bg-[--muted-surface] px-4 py-1"><span class="w-2/3 text-nowrap overflow-x-hidden text-ellipsis"> </span> <div class="text-right"><div class="font-semibold"> </div> <div class="text-sm text-gray-500"> </div></div></div>'),Pt=l('<div class="bg-[--surface] py-4 rounded-lg shadow"><div class="flex justify-between items-center mb-4 px-4"><h3 class="text-lg font-semibold">Top Vendors</h3> <!></div> <div class="space-y-1"></div></div>'),Qt=l('<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"><div class="bg-[--surface] py-4 rounded-lg shadow"><div class="flex justify-between items-center mb-4 px-4"><h3 class="text-lg font-semibold">Expense Categories</h3> <!></div> <div class="space-y-1"></div></div> <!></div>'),Wt=l('<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"><div class="bg-[--surface] p-4 rounded-lg shadow"><h3 class="text-lg font-semibold text-gray-200">Income</h3> <p class="text-2xl font-bold text-green-600"> </p> <p class="text-sm text-gray-500"> </p></div> <div class="bg-[--surface] p-4 rounded-lg shadow"><h3 class="text-lg font-semibold text-gray-200">Expenses</h3> <p class="text-2xl font-bold text-red-600"> </p> <p class="text-sm text-gray-500"> </p></div> <div class="bg-[--surface] p-4 rounded-lg shadow"><h3 class="text-lg font-semibold text-gray-200">Net Balance</h3> <p class="text-2xl font-bold"> </p> <p class="text-sm text-gray-500"> </p></div></div> <!> <div class="mt-8 p-4 bg-[--surface] rounded"><h3 class="text-sm font-mono">Debug Data:</h3> <pre class="text-xs overflow-auto"> </pre></div>',1),Xt=l('<div class="bg-[--surface] border border-yellow-200 text-yellow-600 p-4 rounded-lg"><p>No dashboard data available</p></div>'),Dt=l('<div class="bg-[--surface] border border-red-200 text-red-700 p-4 rounded-lg"><p> </p></div>'),ta=l('<div class="flex items-center justify-center h-64"><p class="text-gray-500">Loading dashboard data...</p></div>'),aa=l('<div class="p-4 container mx-auto"><h1 class="text-3xl font-bold mb-6">Financial Dashboard</h1> <!></div>');function la(m,c){Bt(c,!1);const[H,$]=Jt(),J=Ot(Ht(Lt,"$user",H)),u=(n,s="UAH")=>n==null?"-":new Intl.NumberFormat("uk-UA",{style:"currency",currency:s}).format(n);J.then(n=>{console.log("Dashboard data received:",n)}).catch(n=>{console.error("Dashboard data error:",n)});let L=ct(!1),O=ct(!1);qt();var R=aa(),gt=r(a(R),2);Gt(gt,()=>J,n=>{var s=ta();i(n,s)},(n,s)=>{var b=D(),A=G(b);{var V=h=>{var C=Wt(),Y=G(C),Z=a(Y),K=r(a(Z),2),bt=a(K,!0);t(K);var at=r(K,2),ht=a(at);t(at),t(Z);var M=r(Z,2),P=r(a(M),2),yt=a(P,!0);t(P);var et=r(P,2),wt=a(et);t(et),t(M);var st=r(M,2),k=r(a(st),2),$t=a(k,!0);t(k);var rt=r(k,2),kt=a(rt);t(rt),t(st),t(Y);var ot=r(Y,2);{var jt=j=>{var S=Qt(),E=a(S),N=a(E),Et=r(a(N),2);{var Nt=_=>{var v=Vt();v.__click=[Rt,L];var x=a(v,!0);t(v),w(()=>o(x,e(L)?"Show less":"Show all")),i(_,v)};g(Et,_=>{e(s).data.expense_categories.length>5&&_(Nt)})}t(N);var vt=r(N,2);pt(vt,5,()=>e(s).data.expense_categories,ut,(_,v,x)=>{var F=D(),Q=G(F);{var q=p=>{var d=Yt(),f=a(d),B=a(f,!0);t(f);var I=r(f,2),T=a(I),U=a(T,!0);t(T);var y=r(T,2),z=a(y);t(y),t(I),t(d),w(W=>{o(B,e(v).category||"Uncategorized"),o(U,W),o(z,`${e(v).count??""} transactions`)},[()=>u(e(v).total)],tt),i(p,d)};g(Q,p=>{(e(L)||x<5)&&p(q)})}i(_,F)}),t(vt),t(E);var Tt=r(E,2);{var Ut=_=>{var v=Pt(),x=a(v),F=r(a(x),2);{var Q=p=>{var d=Kt();d.__click=[Zt,O];var f=a(d,!0);t(d),w(()=>o(f,e(O)?"Show less":"Show all")),i(p,d)};g(F,p=>{e(s).data.top_vendors.length>5&&p(Q)})}t(x);var q=r(x,2);pt(q,5,()=>e(s).data.top_vendors,ut,(p,d,f)=>{var B=D(),I=G(B);{var T=U=>{var y=Mt(),z=a(y),W=a(z,!0);t(z);var dt=r(z,2),X=a(dt),zt=a(X,!0);t(X);var lt=r(X,2),At=a(lt);t(lt),t(dt),t(y),w(Ct=>{o(W,e(d).vendor||"Unknown"),o(zt,Ct),o(At,`${e(d).transaction_count??""} transactions`)},[()=>u(e(d).total_spent)],tt),i(U,y)};g(I,U=>{(e(O)||f<5)&&U(T)})}i(p,B)}),t(q),t(v),i(_,v)};g(Tt,_=>{e(s).data.top_vendors&&_(Ut)})}t(S),i(j,S)};g(ot,j=>{e(s).data.expense_categories&&j(jt)})}var it=r(ot,2),nt=r(a(it),2),St=a(nt,!0);t(nt),t(it),w((j,S,E,N)=>{o(bt,j),o(ht,`${e(s).data.basic_stats.income.count||0} transactions`),o(yt,S),o(wt,`${e(s).data.basic_stats.expenses.count||0} transactions`),_t(k,"text-green-600",e(s).data.basic_stats.net>0),_t(k,"text-red-600",e(s).data.basic_stats.net<0),o($t,E),o(kt,`${e(s).data.basic_stats.total_transactions||0} total transactions`),o(St,N)},[()=>u(e(s).data.basic_stats.income.total),()=>u(e(s).data.basic_stats.expenses.total),()=>u(e(s).data.basic_stats.net),()=>JSON.stringify(e(s),null,2)],tt),i(h,C)},mt=h=>{var C=Xt();i(h,C)};g(A,h=>{e(s)&&e(s).data&&e(s).data.basic_stats?h(V):h(mt,!1)})}i(n,b)},(n,s)=>{var b=Dt(),A=a(b),V=a(A);t(A),t(b),w(()=>o(V,`Error loading dashboard: ${e(s)??""}`)),i(n,b)}),t(R),i(m,R),It(),$()}Ft(["click"]);export{la as component};
