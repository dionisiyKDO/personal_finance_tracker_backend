import{f as Ct,t as _,b as n,c as D}from"../chunks/BPOysvG9.js";import{i as Ft}from"../chunks/XqrSmV0d.js";import{Y as qt,_ as Bt,a1 as r,$ as a,a0 as t,a2 as y,v as e,Z as G,w as tt,am as ct,a8 as ft}from"../chunks/C-rDJMBQ.js";import{s as o}from"../chunks/DgqPHchW.js";import{a as It}from"../chunks/BUlX02mU.js";import{s as Gt,a as Ht,i as m}from"../chunks/C_hza7l9.js";import{e as _t,i as pt}from"../chunks/CskFB5GT.js";import{u as Jt}from"../chunks/DO4y2VjW.js";function ut(c,i,$){if($){if(c.classList.contains(i))return;c.classList.add(i)}else{if(!c.classList.contains(i))return;c.classList.remove(i)}}async function Ot(c){try{if(!c)return null;const $=window.location.port!=="8000"?"http://localhost:8000":"",k=await fetch(`${$}/api/dashboard-data/`,{method:"GET",headers:{Authorization:`Token ${c.token}`,"Content-Type":"application/json"}});if(!k.ok){const f=(await k.json()).error||"Failed to fetch dashboard data";return console.log(f),null}return await k.json()}catch(i){return console.error("Error during login:",i),null}}var Rt=(c,i)=>ft(i,!e(i)),Vt=_('<button class="inline-button"> </button>'),Yt=_('<div class="flex justify-between items-center even:bg-[--muted-surface] px-4 py-1"><span class="capitalize"> </span> <div class="text-right"><div class="font-semibold"> </div> <div class="text-sm text-gray-500"> </div></div></div>'),Zt=(c,i)=>ft(i,!e(i)),Kt=_('<button class="inline-button"> </button>'),Mt=_('<div class="flex justify-between items-center even:bg-[--muted-surface] px-4 py-1"><span class="w-2/3 text-nowrap overflow-x-hidden text-ellipsis"> </span> <div class="text-right"><div class="font-semibold"> </div> <div class="text-sm text-gray-500"> </div></div></div>'),Pt=_('<div class="bg-[--surface] py-4 rounded-lg shadow"><div class="flex justify-between items-center mb-4 px-4"><h3 class="text-lg font-semibold">Top Vendors</h3> <!></div> <div class="space-y-1"></div></div>'),Qt=_('<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"><div class="bg-[--surface] py-4 rounded-lg shadow"><div class="flex justify-between items-center mb-4 px-4"><h3 class="text-lg font-semibold">Expense Categories</h3> <!></div> <div class="space-y-1"></div></div> <!></div>'),Wt=_('<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"><div class="bg-[--surface] p-4 rounded-lg shadow"><h3 class="text-lg font-semibold text-gray-200">Income</h3> <p class="text-2xl font-bold text-green-600"> </p> <p class="text-sm text-gray-500"> </p></div> <div class="bg-[--surface] p-4 rounded-lg shadow"><h3 class="text-lg font-semibold text-gray-200">Expenses</h3> <p class="text-2xl font-bold text-red-600"> </p> <p class="text-sm text-gray-500"> </p></div> <div class="bg-[--surface] p-4 rounded-lg shadow"><h3 class="text-lg font-semibold text-gray-200">Net Balance</h3> <p class="text-2xl font-bold"> </p> <p class="text-sm text-gray-500"> </p></div></div> <!> <div class="mt-8 p-4 bg-[--surface] rounded"><h3 class="text-sm font-mono">Debug Data:</h3> <pre class="text-xs overflow-auto"> </pre></div>',1),Xt=_('<div class="bg-[--surface] border border-yellow-200 text-yellow-600 p-4 rounded-lg"><p>No dashboard data available</p></div>'),Dt=_('<div class="bg-[--surface] border border-red-200 text-red-700 p-4 rounded-lg"><p> </p></div>'),ta=_('<div class="flex items-center justify-center h-64"><p class="text-gray-500">Loading dashboard data...</p></div>'),aa=_('<div class="p-4 container mx-auto"><h1 class="text-3xl font-bold mb-6">Financial Dashboard</h1> <!></div>');function da(c,i){qt(i,!1);const[$,k]=Ht(),H=Ot(Gt(Jt,"$user",$)),f=(v,s="UAH")=>v==null?"-":new Intl.NumberFormat("uk-UA",{style:"currency",currency:s}).format(v);H.then(v=>{console.log("Dashboard data received:",v)}).catch(v=>{console.error("Dashboard data error:",v)});let J=ct(!1),O=ct(!1);Ft();var R=aa(),gt=r(a(R),2);It(gt,()=>H,v=>{var s=ta();n(v,s)},(v,s)=>{var b=D(),A=G(b);{var V=h=>{var C=Wt(),Y=G(C),Z=a(Y),K=r(a(Z),2),bt=a(K,!0);t(K);var at=r(K,2),ht=a(at);t(at),t(Z);var M=r(Z,2),P=r(a(M),2),wt=a(P,!0);t(P);var et=r(P,2),yt=a(et);t(et),t(M);var st=r(M,2),j=r(a(st),2),$t=a(j,!0);t(j);var rt=r(j,2),kt=a(rt);t(rt),t(st),t(Y);var ot=r(Y,2);{var jt=S=>{var E=Qt(),L=a(E),N=a(L),Et=r(a(N),2);{var Lt=p=>{var l=Vt();l.__click=[Rt,J];var x=a(l,!0);t(l),y(()=>o(x,e(J)?"Show less":"Show all")),n(p,l)};m(Et,p=>{e(s).data.expense_categories.length>5&&p(Lt)})}t(N);var vt=r(N,2);_t(vt,5,()=>e(s).data.expense_categories,pt,(p,l,x)=>{var F=D(),Q=G(F);{var q=u=>{var d=Yt(),g=a(d),B=a(g,!0);t(g);var I=r(g,2),T=a(I),U=a(T,!0);t(T);var w=r(T,2),z=a(w);t(w),t(I),t(d),y(W=>{o(B,e(l).category||"Uncategorized"),o(U,W),o(z,`${e(l).count??""} transactions`)},[()=>f(e(l).total)],tt),n(u,d)};m(Q,u=>{(e(J)||x<5)&&u(q)})}n(p,F)}),t(vt),t(L);var Nt=r(L,2);{var Tt=p=>{var l=Pt(),x=a(l),F=r(a(x),2);{var Q=u=>{var d=Kt();d.__click=[Zt,O];var g=a(d,!0);t(d),y(()=>o(g,e(O)?"Show less":"Show all")),n(u,d)};m(F,u=>{e(s).data.top_vendors.length>5&&u(Q)})}t(x);var q=r(x,2);_t(q,5,()=>e(s).data.top_vendors,pt,(u,d,g)=>{var B=D(),I=G(B);{var T=U=>{var w=Mt(),z=a(w),W=a(z,!0);t(z);var lt=r(z,2),X=a(lt),Ut=a(X,!0);t(X);var dt=r(X,2),zt=a(dt);t(dt),t(lt),t(w),y(At=>{o(W,e(d).vendor||"Unknown"),o(Ut,At),o(zt,`${e(d).transaction_count??""} transactions`)},[()=>f(e(d).total_spent)],tt),n(U,w)};m(I,U=>{(e(O)||g<5)&&U(T)})}n(u,B)}),t(q),t(l),n(p,l)};m(Nt,p=>{e(s).data.top_vendors&&p(Tt)})}t(E),n(S,E)};m(ot,S=>{e(s).data.expense_categories&&S(jt)})}var it=r(ot,2),nt=r(a(it),2),St=a(nt,!0);t(nt),t(it),y((S,E,L,N)=>{o(bt,S),o(ht,`${e(s).data.basic_stats.income.count||0} transactions`),o(wt,E),o(yt,`${e(s).data.basic_stats.expenses.count||0} transactions`),ut(j,"text-green-600",e(s).data.basic_stats.net>0),ut(j,"text-red-600",e(s).data.basic_stats.net<0),o($t,L),o(kt,`${e(s).data.basic_stats.total_transactions||0} total transactions`),o(St,N)},[()=>f(e(s).data.basic_stats.income.total),()=>f(e(s).data.basic_stats.expenses.total),()=>f(e(s).data.basic_stats.net),()=>JSON.stringify(e(s),null,2)],tt),n(h,C)},mt=h=>{var C=Xt();n(h,C)};m(A,h=>{e(s)&&e(s).data&&e(s).data.basic_stats?h(V):h(mt,!1)})}n(v,b)},(v,s)=>{var b=Dt(),A=a(b),V=a(A);t(A),t(b),y(()=>o(V,`Error loading dashboard: ${e(s)??""}`)),n(v,b)}),t(R),n(c,R),Bt(),k()}Ct(["click"]);export{da as component};
